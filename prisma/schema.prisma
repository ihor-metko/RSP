generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String?
  email         String    @unique
  emailVerified DateTime? @db.Timestamptz(6)
  image         String?
  password      String?
  role          String?   @default("player")
  createdAt     DateTime? @default(now()) @db.Timestamptz(6)
  accounts      Account[]
  bookings      Booking[]
  coaches       Coach[]
  sessions      Session[]
}

model Account {
  id                String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId            String  @db.Uuid
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_account_user")

  @@unique([provider, providerAccountId], map: "unique_provider_account")
}

model Session {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sessionToken String   @unique
  userId       String   @db.Uuid
  expires      DateTime @db.Timestamptz(6)
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_session_user")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime @db.Timestamptz(6)

  @@unique([identifier, token], map: "unique_identifier_token")
}

model Club {
  id             String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name           String
  location       String
  contactInfo    String?
  openingHours   String?
  logo           String?
  createdAt      DateTime?          @default(now()) @db.Timestamptz(6)
  mondayOpen     Int?
  mondayClose    Int?
  tuesdayOpen    Int?
  tuesdayClose   Int?
  wednesdayOpen  Int?
  wednesdayClose Int?
  thursdayOpen   Int?
  thursdayClose  Int?
  fridayOpen     Int?
  fridayClose    Int?
  saturdayOpen   Int?
  saturdayClose  Int?
  sundayOpen     Int?
  sundayClose    Int?
  specialHours   ClubSpecialHours[]
  coaches        Coach[]
  courts         Court[]
  pricingRules   PricingRule[]
}

model ClubSpecialHours {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId    String    @db.Uuid
  date      DateTime  @db.Date
  openTime  Int
  closeTime Int
  createdAt DateTime? @default(now()) @db.Timestamptz(6)
  club      Club      @relation(fields: [clubId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_specialhours_club")

  @@unique([clubId, date], map: "unique_club_date")
}

model Court {
  id                String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId            String        @db.Uuid
  name              String
  slug              String?       @unique
  type              String?
  surface           String?
  indoor            Boolean?      @default(false)
  defaultPriceCents Int?          @default(0)
  courtOpenTime     Int?
  courtCloseTime    Int?
  createdAt         DateTime?     @default(now()) @db.Timestamptz(6)
  updatedAt         DateTime?     @default(now()) @updatedAt @db.Timestamptz(6)
  bookings          Booking[]
  club              Club          @relation(fields: [clubId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_court_club")
  pricingRules      PricingRule[]
}

model Coach {
  id             String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId         String              @db.Uuid
  clubId         String              @db.Uuid
  bio            String?
  createdAt      DateTime?           @default(now()) @db.Timestamptz(6)
  bookings       Booking[]
  club           Club                @relation(fields: [clubId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_coach_club")
  user           User                @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_coach_user")
  availabilities CoachAvailability[]
}

model CoachAvailability {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  coachId   String    @db.Uuid
  start     DateTime  @db.Timestamptz(6)
  end       DateTime  @db.Timestamptz(6)
  createdAt DateTime? @default(now()) @db.Timestamptz(6)
  coach     Coach     @relation(fields: [coachId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_availability_coach")
}

model Booking {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courtId   String    @db.Uuid
  userId    String    @db.Uuid
  coachId   String?   @db.Uuid
  start     DateTime  @db.Timestamptz(6)
  end       DateTime  @db.Timestamptz(6)
  price     Int
  status    String
  paymentId String?
  createdAt DateTime? @default(now()) @db.Timestamptz(6)
  coach     Coach?    @relation(fields: [coachId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_booking_coach")
  court     Court     @relation(fields: [courtId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_booking_court")
  user      User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_booking_user")
  payments  Payment[]
}

model Payment {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  bookingId String    @db.Uuid
  provider  String
  status    String
  amount    Int
  createdAt DateTime? @default(now()) @db.Timestamptz(6)
  booking   Booking   @relation(fields: [bookingId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_payment_booking")
}

model PricingRule {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clubId    String    @db.Uuid
  courtId   String?   @db.Uuid
  startTime Int
  endTime   Int
  price     Int
  createdAt DateTime? @default(now()) @db.Timestamptz(6)
  club      Club      @relation(fields: [clubId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_pricingrule_club")
  court     Court?    @relation(fields: [courtId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_pricingrule_court")
}
