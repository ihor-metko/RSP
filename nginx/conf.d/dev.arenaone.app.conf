# -------------------------------------------------
# HTTP â†’ HTTPS REDIRECT
# -------------------------------------------------
server {
  listen 80;
  server_name dev.arenaone.app;

  return 301 https://$host$request_uri;
}

# -------------------------------------------------
# HTTPS SERVER
# -------------------------------------------------
server {
  listen 443 ssl http2;
  server_name dev.arenaone.app;

  ssl_certificate     /etc/letsencrypt/live/dev.arenaone.app/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/dev.arenaone.app/privkey.pem;

  # -------------------------------------------------
  # STATIC FILES (IMAGES)
  # -------------------------------------------------
  location ^~ /uploads/ {
    alias /var/www/arenaone_storage/;

    autoindex off;

    # Cache forever (images are immutable)
    expires 1y;
    add_header Cache-Control "public, immutable";

    add_header Access-Control-Allow-Origin "*";

    try_files $uri =404;
  }

  # -------------------------------------------------
  # NEXT.JS APP
  # -------------------------------------------------
  location / {
    proxy_pass http://arenaone_app:3000;
    proxy_http_version 1.1;

    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
  }
}
