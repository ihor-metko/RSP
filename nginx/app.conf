server {
  listen 80;
  server_name arenaone.app;

  location / {
    proxy_pass http://arenaone_app:3000;
    proxy_http_version 1.1;

    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";

    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
  }

  # Serve static images directly from storage volume
  location /uploads/ {
    alias /var/www/arenaone_storage/images/;

    # Security: Disable directory listing
    autoindex off;

    # Cache static assets aggressively (images are immutable)
    expires 1y;
    add_header Cache-Control "public, immutable";

    # Add CORS headers for cross-origin requests if needed
    add_header Access-Control-Allow-Origin "*";

    # Serve common image types with correct MIME types
    types {
      image/jpeg jpg jpeg;
      image/png png;
      image/gif gif;
      image/webp webp;
      image/svg+xml svg;
    }

    # Return 404 for missing files
    try_files $uri =404;
  }
}
